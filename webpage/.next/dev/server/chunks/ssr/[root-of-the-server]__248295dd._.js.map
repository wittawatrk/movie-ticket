{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/configs/env.ts"],"sourcesContent":["const env = process.env;\n\nexport namespace Env {\n  export const NODE_ENV = env.NODE_ENV ?? \"production\";\n  export const PORT = env.PORT ?? \"4200\";\n  export const BASE_URL = env.BASE_URL ?? \"http://localhost:4200\";\n  export const API_URL = env.API_URL ?? \"http://localhost:3000/api\";\n  export const API_TIMEOUT = parseInt(env.API_TIMEOUT ?? \"5000\");\n  export const API_MAX_RETRIES = parseInt(env.API_MAX_RETRIES ?? \"3\");\n  export const API_RETRY_DELAY = parseInt(env.API_RETRY_DELAY ?? \"1000\");\n  export const GEOSERVER_URL =\n    env.GEOSERVER_URL ?? \"http://localhost:8080/geoserver\";\n}\n"],"names":[],"mappings":";;;;AAAA,MAAM,MAAM,QAAQ,GAAG;UAEN;QACF,WAAW,mDAAgB;QAC3B,OAAO,IAAI,IAAI,IAAI;QACnB,WAAW,IAAI,QAAQ,IAAI;QAC3B,UAAU,IAAI,OAAO,IAAI;QACzB,cAAc,SAAS,IAAI,WAAW,IAAI;QAC1C,kBAAkB,SAAS,IAAI,eAAe,IAAI;QAClD,kBAAkB,SAAS,IAAI,eAAe,IAAI;QAClD,gBACX,IAAI,aAAa,IAAI;AACzB,GAViB,QAAA"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/services/login.service.ts"],"sourcesContent":["\"use server\";\n\nimport { Env } from \"@/configs/env\";\n\nexport async function login(username: string, password: string) {\n  const url = `${Env.API_URL}/v1/auth/login`;\n  const response = await fetch(url, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify({\n      username,\n      password,\n    }),\n  });\n\n  if (response.status === 401) {\n    return { authorized: false };\n  }\n\n  if (!response.ok) {\n    throw new Error(await response.text());\n  }\n\n  const body = await response.json();\n  if (!body.access_token) return { authorized: false };\n\n  const user = JSON.parse(\n    atob(body.access_token.split(\".\")[1].replace(/-/g, \"+\").replace(/_/g, \"/\"))\n  );\n\n  localStorage.setItem(\"token\", body.access_token);\n  localStorage.setItem(\"user\", JSON.stringify(user));\n\n  return { authorized: true, user };\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAIO,eAAe,MAAM,QAAgB,EAAE,QAAgB;IAC5D,MAAM,MAAM,GAAG,qHAAG,CAAC,OAAO,CAAC,cAAc,CAAC;IAC1C,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YACnB;YACA;QACF;IACF;IAEA,IAAI,SAAS,MAAM,KAAK,KAAK;QAC3B,OAAO;YAAE,YAAY;QAAM;IAC7B;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,MAAM,SAAS,IAAI;IACrC;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,IAAI,CAAC,KAAK,YAAY,EAAE,OAAO;QAAE,YAAY;IAAM;IAEnD,MAAM,OAAO,KAAK,KAAK,CACrB,KAAK,KAAK,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;IAGxE,aAAa,OAAO,CAAC,SAAS,KAAK,YAAY;IAC/C,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;IAE5C,OAAO;QAAE,YAAY;QAAM;IAAK;AAClC"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/Modules/Auth/login.tsx"],"sourcesContent":["'use client';\nimport { useSnackbar } from '@/components/snackbar';\nimport { login } from '@/services/login.service';\nimport {\n  Button,\n  Card,\n  CardContent,\n  Divider,\n  TextField,\n  Typography,\n  Box,\n  Stack,\n} from '@mui/material';\nimport LoadingButton from '@mui/lab/LoadingButton';\nimport Link from 'next/link';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { useCallback, useState } from 'react';\nimport { useLocalStorage } from 'usehooks-ts';\n\nexport default function LoginPage() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const [loggingIn, setLoggingIn] = useState<boolean>(false);\n  const [_, setUserStore] = useLocalStorage('user', null);\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n\n  const afterLogin = useCallback(() => {\n    const redirect = searchParams?.get('redirect');\n\n    if (redirect) {\n      router.replace(redirect);\n      return;\n    }\n\n    // redirect ตาม role\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\n\n    if (user.role === 'ADMIN') {\n      router.replace('/admin');\n    } else {\n      router.replace('/dashboard');\n    }\n  }, [searchParams, router]);\n\n  const { success, error } = useSnackbar();\n\n  const onSubmit = useCallback(async () => {\n    try {\n      setLoggingIn(true);\n\n      const loginResult = await login(username, password);\n\n      if (!loginResult.authorized) {\n        error('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');\n        return;\n      }\n\n      setUserStore(loginResult.user);\n      success('เข้าสู่ระบบสำเร็จ');\n      afterLogin();\n    } catch (e: any) {\n      error(e.message || 'ไม่สามารถเข้าสู่ระบบได้');\n    } finally {\n      setLoggingIn(false);\n    }\n  }, [username, password, afterLogin, setUserStore, success, error]);\n\n  return (\n    <Box sx={{ maxWidth: 420, mx: 'auto', mt: 10 }}>\n      <Card elevation={3}>\n        <CardContent sx={{ p: 4 }}>\n          <Typography variant=\"h5\" align=\"center\" gutterBottom>\n            เข้าสู่ระบบ\n          </Typography>\n\n          <TextField\n            fullWidth\n            label=\"อีเมล\"\n            margin=\"normal\"\n            value={username}\n            onChange={(e) => setUsername(e.target.value)}\n          />\n\n          <TextField\n            fullWidth\n            type=\"password\"\n            label=\"รหัสผ่าน\"\n            margin=\"normal\"\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n          />\n\n          <Stack direction=\"row\" justifyContent=\"flex-end\" spacing={1} mt={3}>\n            <Button variant=\"outlined\" onClick={() => history.back()}>\n              ย้อนกลับ\n            </Button>\n\n            <LoadingButton\n              variant=\"contained\"\n              loading={loggingIn}\n              onClick={onSubmit}\n            >\n              เข้าสู่ระบบ\n            </LoadingButton>\n          </Stack>\n        </CardContent>\n      </Card>\n    </Box>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAEA;AACA;AACA;;;;;;AAjBA;;;;;;;;;AAmBe,SAAS;IACtB,MAAM,eAAe,IAAA,8IAAe;IACpC,MAAM,SAAS,IAAA,wIAAS;IACxB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+GAAQ,EAAU;IACpD,MAAM,CAAC,GAAG,aAAa,GAAG,IAAA,oMAAe,EAAC,QAAQ;IAClD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IAEzC,MAAM,aAAa,IAAA,kHAAW,EAAC;QAC7B,MAAM,WAAW,cAAc,IAAI;QAEnC,IAAI,UAAU;YACZ,OAAO,OAAO,CAAC;YACf;QACF;QAEA,oBAAoB;QACpB,MAAM,OAAO,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,WAAW;QAExD,IAAI,KAAK,IAAI,KAAK,SAAS;YACzB,OAAO,OAAO,CAAC;QACjB,OAAO;YACL,OAAO,OAAO,CAAC;QACjB;IACF,GAAG;QAAC;QAAc;KAAO;IAEzB,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,IAAA,+IAAW;IAEtC,MAAM,WAAW,IAAA,kHAAW,EAAC;QAC3B,IAAI;YACF,aAAa;YAEb,MAAM,cAAc,MAAM,IAAA,qIAAK,EAAC,UAAU;YAE1C,IAAI,CAAC,YAAY,UAAU,EAAE;gBAC3B,MAAM;gBACN;YACF;YAEA,aAAa,YAAY,IAAI;YAC7B,QAAQ;YACR;QACF,EAAE,OAAO,GAAQ;YACf,MAAM,EAAE,OAAO,IAAI;QACrB,SAAU;YACR,aAAa;QACf;IACF,GAAG;QAAC;QAAU;QAAU;QAAY;QAAc;QAAS;KAAM;IAEjE,qBACE,qKAAC,wLAAG;QAAC,IAAI;YAAE,UAAU;YAAK,IAAI;YAAQ,IAAI;QAAG;kBAC3C,cAAA,qKAAC,4LAAI;YAAC,WAAW;sBACf,cAAA,qKAAC,wNAAW;gBAAC,IAAI;oBAAE,GAAG;gBAAE;;kCACtB,qKAAC,oNAAU;wBAAC,SAAQ;wBAAK,OAAM;wBAAS,YAAY;kCAAC;;;;;;kCAIrD,qKAAC,gNAAS;wBACR,SAAS;wBACT,OAAM;wBACN,QAAO;wBACP,OAAO;wBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;kCAG7C,qKAAC,gNAAS;wBACR,SAAS;wBACT,MAAK;wBACL,OAAM;wBACN,QAAO;wBACP,OAAO;wBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;kCAG7C,qKAAC,gMAAK;wBAAC,WAAU;wBAAM,gBAAe;wBAAW,SAAS;wBAAG,IAAI;;0CAC/D,qKAAC,oMAAM;gCAAC,SAAQ;gCAAW,SAAS,IAAM,QAAQ,IAAI;0CAAI;;;;;;0CAI1D,qKAAC,wNAAa;gCACZ,SAAQ;gCACR,SAAS;gCACT,SAAS;0CACV;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQb"}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/pages/login/index.tsx"],"sourcesContent":["import LoginPage from '@/Modules/Auth/login';\n\nfunction Page() {\n  return <LoginPage />;\n}\n\nPage.guestOnly = true;\nexport default Page;"],"names":[],"mappings":";;;;;AAAA;;;;;;;AAEA,SAAS;IACP,qBAAO,qKAAC,oIAAS;;;;;AACnB;AAEA,KAAK,SAAS,GAAG;uCACF"}}]
}