{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/configs/env.ts"],"sourcesContent":["const env = process.env;\n\nexport namespace Env {\n  export const NODE_ENV = env.NODE_ENV ?? \"production\";\n  export const PORT = env.PORT ?? \"4200\";\n  export const BASE_URL = env.BASE_URL ?? \"http://localhost:4200\";\n  export const API_URL = env.API_URL ?? \"http://localhost:3000/api\";\n  export const API_TIMEOUT = parseInt(env.API_TIMEOUT ?? \"5000\");\n  export const API_MAX_RETRIES = parseInt(env.API_MAX_RETRIES ?? \"3\");\n  export const API_RETRY_DELAY = parseInt(env.API_RETRY_DELAY ?? \"1000\");\n  export const GEOSERVER_URL =\n    env.GEOSERVER_URL ?? \"http://localhost:8080/geoserver\";\n}\n"],"names":[],"mappings":";;;;AAAA,MAAM,MAAM,QAAQ,GAAG;UAEN;QACF,WAAW,mDAAgB;QAC3B,OAAO,IAAI,IAAI,IAAI;QACnB,WAAW,IAAI,QAAQ,IAAI;QAC3B,UAAU,IAAI,OAAO,IAAI;QACzB,cAAc,SAAS,IAAI,WAAW,IAAI;QAC1C,kBAAkB,SAAS,IAAI,eAAe,IAAI;QAClD,kBAAkB,SAAS,IAAI,eAAe,IAAI;QAClD,gBACX,IAAI,aAAa,IAAI;AACzB,GAViB,QAAA"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/services/login.service.ts"],"sourcesContent":["\"use server\";\n\nimport { Env } from \"@/configs/env\";\n\nexport async function login(username: string, password: string) {\n  const url = `${Env.API_URL}/v1/auth/login`;\n  const response = await fetch(url, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify({\n      username,\n      password,\n    }),\n  });\n\n  if (response.status === 401) {\n    return { authorized: false };\n  }\n\n  if (!response.ok) {\n    throw new Error(await response.text());\n  }\n\n  const body = await response.json();\n  if (!body.access_token) return { authorized: false };\n\n  const user = JSON.parse(\n    atob(body.access_token.split(\".\")[1].replace(/-/g, \"+\").replace(/_/g, \"/\"))\n  );\n\n  localStorage.setItem(\"token\", body.access_token);\n  localStorage.setItem(\"user\", JSON.stringify(user));\n\n  return { authorized: true, user };\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAIO,eAAe,MAAM,QAAgB,EAAE,QAAgB;IAC5D,MAAM,MAAM,GAAG,qHAAG,CAAC,OAAO,CAAC,cAAc,CAAC;IAC1C,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YACnB;YACA;QACF;IACF;IAEA,IAAI,SAAS,MAAM,KAAK,KAAK;QAC3B,OAAO;YAAE,YAAY;QAAM;IAC7B;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,MAAM,SAAS,IAAI;IACrC;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,IAAI,CAAC,KAAK,YAAY,EAAE,OAAO;QAAE,YAAY;IAAM;IAEnD,MAAM,OAAO,KAAK,KAAK,CACrB,KAAK,KAAK,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;IAGxE,aAAa,OAAO,CAAC,SAAS,KAAK,YAAY;IAC/C,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;IAE5C,OAAO;QAAE,YAAY;QAAM;IAAK;AAClC"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/Modules/Auth/login.tsx"],"sourcesContent":["'use client';\nimport { login } from '@/services/login.service';\nimport {\n  Button,\n  Card,\n  CardContent,\n  Divider,\n  TextField,\n  Typography,\n  Box,\n} from '@mui/material';\nimport Link from 'next/link';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { useCallback, useState } from 'react';\nimport { useLocalStorage } from 'usehooks-ts';\n\nexport default function LoginPage() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const [loggingIn, setLoggingIn] = useState<boolean>(false);\n  const [_, setUserStore] = useLocalStorage('user', null);\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n\n  const afterLogin = useCallback(() => {\n    const redirect = searchParams?.get('redirect');\n\n    if (redirect) {\n      router.replace(redirect);\n      return;\n    }\n\n    // redirect ตาม role\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\n\n    if (user.role === 'ADMIN') {\n      router.replace('/admin');\n    } else {\n      router.replace('/dashboard');\n    }\n  }, [searchParams, router]);\n\n  const onSubmit = useCallback(async () => {\n    setLoggingIn(true);\n    const loginResult = await login(username, password);\n    if (!loginResult.authorized) {\n      // TODO: handle login failed\n    } else {\n      setUserStore(loginResult.user);\n      afterLogin();\n    }\n    setLoggingIn(false);\n  }, [username, password, afterLogin, setUserStore]);\n\n  return (\n    <Box maxWidth={450} mx=\"auto\" mt={6}>\n      <Card>\n        <CardContent>\n          <Typography variant=\"h5\" align=\"center\" mb={2}>\n            เข้าสู่ระบบ\n          </Typography>\n\n          <TextField\n            fullWidth\n            label=\"อีเมล\"\n            margin=\"normal\"\n            value={username}\n            onChange={(e) => setUsername(e.target.value)}\n          />\n\n          <TextField\n            fullWidth\n            type=\"password\"\n            label=\"รหัสผ่าน\"\n            margin=\"normal\"\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n          />\n\n          <Box display=\"flex\" justifyContent=\"flex-end\" mt={2}>\n            <Button\n              variant=\"outlined\"\n              sx={{ mr: 1 }}\n              onClick={() => history.back()}\n            >\n              ย้อนกลับ\n            </Button>\n            <Button\n              variant=\"contained\"\n              onClick={onSubmit}\n              disabled={loggingIn}\n            >\n              เข้าสู่ระบบ\n            </Button>\n          </Box>\n\n          <Divider sx={{ my: 2 }}>หรือ</Divider>\n\n          <Box textAlign=\"center\">\n            <Link href=\"/auth/register\">ลงทะเบียนใช้งาน</Link>\n          </Box>\n        </CardContent>\n      </Card>\n    </Box>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;;;;;AAdA;;;;;;;;AAgBe,SAAS;IACtB,MAAM,eAAe,IAAA,8IAAe;IACpC,MAAM,SAAS,IAAA,wIAAS;IACxB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+GAAQ,EAAU;IACpD,MAAM,CAAC,GAAG,aAAa,GAAG,IAAA,oMAAe,EAAC,QAAQ;IAClD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IAEzC,MAAM,aAAa,IAAA,kHAAW,EAAC;QAC7B,MAAM,WAAW,cAAc,IAAI;QAEnC,IAAI,UAAU;YACZ,OAAO,OAAO,CAAC;YACf;QACF;QAEA,oBAAoB;QACpB,MAAM,OAAO,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,WAAW;QAExD,IAAI,KAAK,IAAI,KAAK,SAAS;YACzB,OAAO,OAAO,CAAC;QACjB,OAAO;YACL,OAAO,OAAO,CAAC;QACjB;IACF,GAAG;QAAC;QAAc;KAAO;IAEzB,MAAM,WAAW,IAAA,kHAAW,EAAC;QAC3B,aAAa;QACb,MAAM,cAAc,MAAM,IAAA,qIAAK,EAAC,UAAU;QAC1C,IAAI,CAAC,YAAY,UAAU,EAAE;QAC3B,4BAA4B;QAC9B,OAAO;YACL,aAAa,YAAY,IAAI;YAC7B;QACF;QACA,aAAa;IACf,GAAG;QAAC;QAAU;QAAU;QAAY;KAAa;IAEjD,qBACE,qKAAC,wLAAG;QAAC,UAAU;QAAK,IAAG;QAAO,IAAI;kBAChC,cAAA,qKAAC,4LAAI;sBACH,cAAA,qKAAC,wNAAW;;kCACV,qKAAC,oNAAU;wBAAC,SAAQ;wBAAK,OAAM;wBAAS,IAAI;kCAAG;;;;;;kCAI/C,qKAAC,gNAAS;wBACR,SAAS;wBACT,OAAM;wBACN,QAAO;wBACP,OAAO;wBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;kCAG7C,qKAAC,gNAAS;wBACR,SAAS;wBACT,MAAK;wBACL,OAAM;wBACN,QAAO;wBACP,OAAO;wBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;kCAG7C,qKAAC,wLAAG;wBAAC,SAAQ;wBAAO,gBAAe;wBAAW,IAAI;;0CAChD,qKAAC,oMAAM;gCACL,SAAQ;gCACR,IAAI;oCAAE,IAAI;gCAAE;gCACZ,SAAS,IAAM,QAAQ,IAAI;0CAC5B;;;;;;0CAGD,qKAAC,oMAAM;gCACL,SAAQ;gCACR,SAAS;gCACT,UAAU;0CACX;;;;;;;;;;;;kCAKH,qKAAC,wMAAO;wBAAC,IAAI;4BAAE,IAAI;wBAAE;kCAAG;;;;;;kCAExB,qKAAC,wLAAG;wBAAC,WAAU;kCACb,cAAA,qKAAC,gIAAI;4BAAC,MAAK;sCAAiB;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMxC"}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/guards/GuessGuard.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\n\nexport default function GuestGuard({ children }: { children: React.ReactNode }) {\n  const router = useRouter();\n  const [allow, setAllow] = useState(false);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\nconsole.log(token);\n    if (token) {\n      const userRaw = localStorage.getItem('user');\n      const user = userRaw ? JSON.parse(userRaw) : null;\n\n      if (user?.role === 'ADMIN') {\n        router.replace('/admin');\n      } else {\n        router.replace('/dashboard');\n      }\n    } else {\n      console.error('Not logged in.');\n      setAllow(true); // อนุญาตให้เห็นหน้า login\n    }\n  }, [router]);\n\n  if (!allow) return null; // หรือ <Loading />\n\n  return <>{children}</>;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS,WAAW,EAAE,QAAQ,EAAiC;IAC5E,MAAM,SAAS,IAAA,oIAAS;IACxB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+GAAQ,EAAC;IAEnC,IAAA,gHAAS,EAAC;QACR,MAAM,QAAQ,aAAa,OAAO,CAAC;QACvC,QAAQ,GAAG,CAAC;QACR,IAAI,OAAO;YACT,MAAM,UAAU,aAAa,OAAO,CAAC;YACrC,MAAM,OAAO,UAAU,KAAK,KAAK,CAAC,WAAW;YAE7C,IAAI,MAAM,SAAS,SAAS;gBAC1B,OAAO,OAAO,CAAC;YACjB,OAAO;gBACL,OAAO,OAAO,CAAC;YACjB;QACF,OAAO;YACL,QAAQ,KAAK,CAAC;YACd,SAAS,OAAO,0BAA0B;QAC5C;IACF,GAAG;QAAC;KAAO;IAEX,IAAI,CAAC,OAAO,OAAO,MAAM,mBAAmB;IAE5C,qBAAO;kBAAG;;AACZ"}},
    {"offset": {"line": 319, "column": 0}, "map": {"version":3,"sources":["file:///Users/wittawat/work/freelance/concert-tiket/consert-ticket/web/src/pages/login/index.tsx"],"sourcesContent":["import LoginPage from '../../Modules/Auth/login';\nimport GuestGuard from '../../guards/GuessGuard';\n\n\nexport default function Home() {\n  return (\n    <GuestGuard>\n      <LoginPage />\n    </GuestGuard>\n\n  );\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;;;;AAGe,SAAS;IACtB,qBACE,qKAAC,gIAAU;kBACT,cAAA,qKAAC,oIAAS;;;;;;;;;;AAIhB"}}]
}